{% extends 'base.html.twig' %}

{% block body %}
<div class="page-header d-print-none">
  <div class="container-xl">
    <h1 class="page-title mb-3">Horaire d'affluence de la semaine</h1>
    <p class="text-muted">Nombre de ventes par heure pour chaque jour de la semaine.</p>
  </div>
</div>

<div class="container-xl py-4">
  <div class="card shadow-sm">
    <div class="card-body">
      <canvas id="weeklyAffluenceChart" height="120"></canvas>
    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
// Get canvas context
const ctx = document.getElementById('weeklyAffluenceChart');

// Prepare data
const data = {
  labels: {{ hours|json_encode|raw }},
  datasets: [
    {% for day, values in affluence %}
    {
      label: '{{ day }}',
      data: {{ values|json_encode|raw }},
      backgroundColor: 'hsl({{ loop.index0 * 50 }}, 70%, 60%)',
      borderColor: 'hsl({{ loop.index0 * 50 }}, 70%, 40%)',
      borderWidth: 1
    },
    {% endfor %}
  ]
};

// Create bar chart (non-stacked, side-by-side bars)
new Chart(ctx, {
  type: 'bar',
  data: data,
  options: {
    responsive: true,
    interaction: { mode: 'index', intersect: false },
    plugins: {
      legend: { display: true, position: 'top' },
      tooltip: { mode: 'index', intersect: false }
    },
    scales: {
      x: { 
        title: { display: true, text: 'Heure (milieu de tranche)' },
        stacked: false, // <-- bars side by side
        ticks: { maxRotation: 0 }
      },
      y: { 
        title: { display: true, text: 'Nombre de ventes' },
        beginAtZero: true,
        stacked: false // <-- disable stacking
      }
    }
  }
});
</script>
{% endblock %}