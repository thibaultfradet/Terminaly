{% extends '@EasyAdmin/page/content.html.twig' %}

{% block content %}
<div class="w-100">
    <h1 class="text-2xl font-bold mb-4">Statistiques pour {{ product.name }}</h1>

    <!-- Cards -->
    <div class="row mb-4">
        <div class="col-md-3 border p-3 text-white bg-dark me-2">
            <h4>Total ventes</h4>
            <p class="fs-3">{{ totalSalesCount }}</p>
        </div>
        <div class="col-md-3 border p-3 text-white bg-dark">
            <h4>Chiffre généré</h4>
            <p class="fs-3">{{ totalRevenue|number_format(2, '.', ',') }} €</p>
        </div>
    </div>

    <!-- Sélection du mois -->
    <form method="get" class="mb-3">
        <label for="month">Mois :</label>
        <select name="month" id="month" onchange="this.form.submit()" class="form-select w-auto d-inline-block ms-2">
            {% for num, name in months %}
                <option value="{{ num }}" {% if currentMonth == num %}selected{% endif %}>{{ name }}</option>
            {% endfor %}
        </select>
    </form>

    <!-- Graphiques côte à côte -->
    <div class="row">
        <div class="col-md-6">
            <h5 class="text-white mb-2">Nombre de ventes par jour</h5>
            <canvas id="salesChart" class="bg-dark p-3 rounded"></canvas>
        </div>
        <div class="col-md-6">
            <h5 class="text-white mb-2">Chiffre généré (€) par jour</h5>
            <canvas id="revenueChart" class="bg-dark p-3 rounded"></canvas>
        </div>
    </div>
</div>

<!-- Chart.js CDN -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
const salesCtx = document.getElementById('salesChart').getContext('2d');
const revenueCtx = document.getElementById('revenueChart').getContext('2d');

new Chart(salesCtx, {
    type: 'bar',
    data: {
        labels: {{ dailySalesLabels|json_encode|raw }},
        datasets: [{
            label: 'Nombre de ventes',
            data: {{ dailySalesValues|json_encode|raw }},
            backgroundColor: 'rgba(75, 192, 192, 0.7)',
            borderColor: 'rgba(255, 255, 255, 1)',
            borderWidth: 1
        }]
    },
    options: {
        responsive: true,
        scales: {
            x: { ticks: { color: 'white' }, grid: { color: 'rgba(255,255,255,0.1)' } },
            y: { beginAtZero: true, ticks: { color: 'white' }, grid: { color: 'rgba(255,255,255,0.1)' } }
        },
        plugins: { legend: { labels: { color: 'white' } } }
    }
});

new Chart(revenueCtx, {
    type: 'bar',
    data: {
        labels: {{ dailySalesLabels|json_encode|raw }},
        datasets: [{
            label: 'Chiffre généré (€)',
            data: {{ dailyRevenueValues|json_encode|raw }},
            backgroundColor: 'rgba(255, 206, 86, 0.7)',
            borderColor: 'rgba(255, 255, 255, 1)',
            borderWidth: 1
        }]
    },
    options: {
        responsive: true,
        scales: {
            x: { ticks: { color: 'white' }, grid: { color: 'rgba(255,255,255,0.1)' } },
            y: { beginAtZero: true, ticks: { color: 'white' }, grid: { color: 'rgba(255,255,255,0.1)' } }
        },
        plugins: { legend: { labels: { color: 'white' } } }
    }
});
</script>
{% endblock %}
